function isMobile(){var e=navigator.userAgent.toLowerCase(),i=e.match(/(iphone|ipod|ipad)/),t=e.match(/(silk|kindle)/i),n=e.match(/android/);return i||t||n||e.match(/(blackberry|bb10|mobi|tablet|playbook|opera mini|nexus 7)/i)}function initMainPage(){function e(){++i>8&&(i=1);var t=jQuery(".main-img-after.main"+i);jQuery(t).fadeIn(1500,function(){jQuery(".main-img-after").not(this).fadeOut(10)}),setTimeout(e,5e3)}var i=Math.floor(8*Math.random())+1;jQuery(".main-img-after.main"+i).fadeIn(0),setTimeout(e,5e3)}function activate_menu(e){jQuery(e).closest(".office-menu").find(".sel").removeClass("sel"),jQuery(e).addClass("sel")}function initTitle(e){jQuery(e).each(function(e,i){var t=jQuery(i).find("h1,h2");jQuery(t).css("width",realTitleWidth(jQuery(t))+50)})}function initChosen(e){jQuery(e).chosen({width:"100%"}).on("change",function(e){this.fire(Tapestry.ACTION_EVENT,e)})}function showProductModal(e){var i=jQuery("#product-modal-template"),t=jQuery("div[data-productid='"+e+"']:first"),n=jQuery(t).find(".modal-data"),o=i.find(".block1"),d=i.find(".block2"),r=i.find(".block3"),a=function(){r.show(),r.height(o.height()-r.position().top)};"true"==n.find("div.has-block2").text()?d.show():d.hide(),o.find("a.product-link").attr("href",n.find("div.url").text()),o.find("img.product-image").attr("src",n.find("div.image").text()),o.find("div.category").empty().append(n.find(".category").clone().children()),o.find("div.cook").empty().append(n.find(".cook").clone().children()),o.find("div.name").empty().append(n.find(".name").clone()),o.find("div.price").empty().append(n.find(".price").clone()),o.find("div.basket").empty().append(n.find(".basket").clone().click(function(){triggerEvent(t.find("a.basket-add").get(0),"click")})),d.find("div.desc").empty().append(n.find(".desc").clone().html()),d.find("div.tags").empty().append(n.find(".tags").clone().children()),r.hide(),i.hasClass("in")?a():i.modal("show").unbind("shown.bs.modal").bind("shown.bs.modal",function(){return a(),!1}).unbind("hidden.bs.modal").bind("hidden.bs.modal",function(){jQuery(document).unbind("keydown")}),i.find(".modal-arrow").unbind("click").bind("click",function(){jQuery(this).hasClass("arrow-left")&&productLeftScroll(e),jQuery(this).hasClass("arrow-right")&&productRightScroll(e)}),jQuery(document).unbind("keydown").bind("keydown",function(i){return 37==i.keyCode&&productLeftScroll(e),39==i.keyCode&&productRightScroll(e),!1}),triggerEvent(jQuery(".recommended-link",t).get(0),"click")}function productLeftScroll(e){var i=jQuery("div[data-productid='"+e+"']:first");e=i.prev().attr("data-productid"),void 0!=e&&showProductModal(e)}function productRightScroll(e){var i=jQuery("div[data-productid='"+e+"']:first"),e=i.next().attr("data-productid");void 0!=e&&showProductModal(e)}function initProductInCatalog(e){jQuery(e).find("a.deleteConfirm").click(function(e){var i=jQuery(this).closest(".product-item");i.fadeOut(300,function(){jQuery(this).remove()}),e.stopPropagation()}),jQuery(e).find("img.product-image").click(function(){showProductModal(jQuery(this).closest("div.product-item").attr("data-productid"))}),jQuery(e).mouseenter(function(){jQuery(this).find("img").css("opacity","1")}).mouseleave(function(){jQuery(this).find("img").css("opacity","0.9")})}function initProductCatalogFixed(){var e=jQuery("div.product-item.fixed");initProductInCatalog(e),jQuery(e).each(function(){var e=jQuery(".pic",this);jQuery(".data",this).height(jQuery(this).height()-e.height()-20)}).fadeIn(50),initBasket()}function initProductCatalogEdit(){jQuery(".product-item").mouseenter(function(){jQuery("div.pic .edit-block",this).css("display","block")}).mouseleave(function(){jQuery("div.pic .edit-block",this).css("display","none")})}function initProductCatalog(e){var i=function(e){var i=jQuery("div.product-item",jQuery("div[id^='productsZone']")),t=jQuery.map(jQuery("div.product-item",e),function(e){return jQuery(e).attr("id")});jQuery(i).each(function(i,n){var o=jQuery(n).attr("id");jQuery.inArray(o,t)<0&&jQuery(n).appendTo(e)}),jQuery(e).freetile({animate:!1,selector:".product-item",containerResize:!1,callback:function(){var i=jQuery("div.product-modal-trigger",e);jQuery(i).filter(function(){return"none"==jQuery(this).css("display")}).fadeIn(100),initProductInCatalog(i)}})};i(jQuery("#product-items")),initBasket();var t=!0;Event.observe(e.get(0),Tapestry.ZONE_UPDATED_EVENT,function(){i(jQuery("#product-items")),setTimeout(function(){t=!0},500)}),jQuery(window).scroll(function(){t&&jQuery(window).scrollTop()+jQuery(window).height()>jQuery(document).height()-50&&(t=!1,triggerEvent(jQuery("a[id^=fetchProducts]").get(0),"click"))})}function initBasket(){Event.observe(jQuery("span[id^='basketZone']").get(0),Tapestry.ZONE_UPDATED_EVENT,function(){jQuery(".basket-show").show().mouseenter(function(){jQuery(this).stop().fadeIn(100)}).mouseleave(function(){jQuery(this).stop().fadeOut(1e3)}).delay(2e3).fadeOut(1e3)})}function initProductsEdit(){jQuery("div.product-edit-modal").each(function(e,i){initProductEdit(i)})}function initProductEdit(e){toggleProductEdit(e,!1)}function addMoreProperties(e,i){var t=jQuery(i,e),n=jQuery("select:last",t),o=jQuery(n).clone();jQuery(o).insertAfter(n),initChosen(jQuery(o))}function toggleProductEdit(e,i){if(i)modal=jQuery(e).closest(".product-edit-modal"),modal.modal("hide"),initProductEdit(modal),jQuery("body").removeClass("modal-open");else{jQuery(".product-details",e).addClass("hidden"),jQuery(".properties-details",e).addClass("hidden"),jQuery(".photo-details",e).addClass("hidden");var t=jQuery(e).find("input[name='stage']").attr("value");"DESC"==t&&jQuery(".product-details",e).removeClass("hidden"),"PROP"==t&&jQuery(".properties-details",e).removeClass("hidden"),"PHOTO"==t&&jQuery(".photo-details",e).removeClass("hidden")}initTitle(jQuery("div.title",e)),initFineUploader(jQuery(e).find("div.upload-file"))}function initLoginModal(){var e=function(){jQuery(".modal-dialog.login").hide(),jQuery(".modal-dialog.remember").hide(),jQuery(".modal-dialog.application").hide(),jQuery(".modal-dialog.signup").hide(),jQuery(".modal-dialog div.t-error").hide(),jQuery(".modal-dialog .error").hide(),jQuery(".modal-body.result").hide(),jQuery(".modal-body.data").hide(),jQuery(".modal-body input.t-error").removeClass("t-error")};jQuery(".forget-link").unbind("click").bind("click",function(){e(),jQuery(".modal-dialog.remember").show(),jQuery(".modal-body.data").show()}),jQuery(".login-link").unbind("click").bind("click",function(){e(),jQuery(".modal-dialog.login").show()}),jQuery(".signup-link").unbind("click").bind("click",function(){e(),jQuery(".modal-dialog.signup").show()}),jQuery(".application-link").unbind("click").bind("click",function(){e(),jQuery(".modal-dialog.application").show()})}function showModalResult(e){jQuery(e).find(".data").hide()}function initFineUploader(e){jQuery(e).each(function(e,i){var t=jQuery(".uploader-button",i),n=jQuery(i).attr("data-type"),o=jQuery(i).attr("data-size"),d=jQuery(i).attr("data-objectid");t.fineUploader({request:{endpoint:"/upload?file_type="+n+"&object_id="+d},validation:{allowedExtensions:["jpeg","jpg","png"],sizeLimit:10485760,itemLimit:1}}).on("complete",function(e,t,n,d){var r=new Date;jQuery(i).find("img").attr("src",d[o]+"?"+r.getTime())})})}function realTitleWidth(e){var i=e.clone();i.css("visibility","hidden"),jQuery("body").append(i);var t=i.find("span").width();return i.remove(),t}function triggerEvent(e,i){if(e&&i){if(document.createEvent){var t=document.createEvent("HTMLEvents");return t.initEvent(i,!0,!0),e.dispatchEvent(t)}if(e.fireEvent)return e.fireEvent("on"+i)}}jQuery.noConflict(),function(){var e=!1;if(window.jQuery){var i=jQuery("*");jQuery.each(["hide.bs.dropdown","hide.bs.collapse","hide.bs.modal","hide.bs.tooltip","hide.bs.popover"],function(t,n){i.on(n,function(){e=!0})})}var t=Element.hide;Element.addMethods({hide:function(i){return e?(e=!1,i):t(i)}})}(),Event.observe(document,Tapestry.ZONE_UPDATED_EVENT,function(){initChosen(jQuery(this).find("select.chosen-select")),initTitle(jQuery(this).find("div.title")),initFineUploader(jQuery("div.upload-file"))}),jQuery(document).ready(function(){jQuery("ul.dropdown-menu").each(function(){var e=jQuery(this).parent().innerWidth(),i=jQuery(this).innerWidth(),t=e/2-i/2;t+="px",jQuery(this).css("margin-left",t)}),jQuery("body").addClass(isMobile()?"mobile":"desktop"),jQuery(".tip").tooltip({placement:"bottom"}),initChosen(jQuery("select.chosen-select")),initLoginModal(),initTitle(jQuery("div.title")),initFineUploader(jQuery("div.upload-file"))});