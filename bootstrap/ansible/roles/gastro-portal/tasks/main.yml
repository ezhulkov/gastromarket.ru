---
  - name: make sure that nessesary directories exists
    file: path={{ item }} state=directory mode=0777 group=root owner=root
    with_items:
      - "/var/log/gastro"
      - "/var/lib/gastro"

  - name: cleanup tomcat7 work files
    shell: rm -fr /var/lib/tomcat7/work/*

  - name: cleanup tomcat7 war file
    shell: rm -fr /var/lib/tomcat7/webapps/ROOT.war

  - name: cleanup tomcat7 logs
    shell: rm -fr /var/lib/tomcat7/logs/*

  - name: upload application
    copy: src=../../gastro-portal/target/gastromarket.war dest=/var/lib/tomcat7/webapps/ROOT.war owner=tomcat7 group=tomcat7 mode=0644

  - name: upload static
    copy: src=../../gastro-portal/target/static.tar.gz dest=/tmp/static.tar.gz owner=nginx group=nginx mode=0644

  - name: untar static
    unarchive: src=/tmp/static.tar.gz dest=/ copy=false

  - name: restart tomcat7
    service: name=tomcat7 state=restarted

  - name: restart nginx
    service: name=nginx state=restarted